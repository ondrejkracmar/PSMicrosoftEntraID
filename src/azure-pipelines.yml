name: Publish Powershell Module To Private Repository 
trigger:
  - main

resources:
  repositories:
    - repository: DevOpsAutomation
      type: git
      name: AutomationPlatform/DevOpsAutomation
      ref: master
steps:
   - task: PowerShell@2
     displayName: Install Prerequisites For Validation
     inputs:
       targetType: filePath
       filePath: "./src//build/vsts-prerequisites.ps1"

   - task: PowerShell@2
     displayName: Validation/Test Powershell Module
     inputs:
       targetType: filePath
       filePath: "./src/build/vsts-validate.ps1"

   - task: PublishTestResults@2
     displayName: "Publish Test Results **/TEST-*.xml"
     inputs:
       testResultsFormat: NUnit
     condition: always()

   - task: PowerShell@2
     displayName: Build Nuget For Powerhell module
     inputs:
       targetType: filePath
       filePath: "./src/build/vsts-build.ps1"
       arguments: > # Use this to avoid newline characters in multiline string
          -WorkingDirectory "./src"
          -LocalRepo

   - task: PowerShell@2
     displayName: Test Nuget For Powerhell module exists
     inputs:
        targetType: inline
        script: |
          Get-ChildItem -Path ./src -Recurse | fl
        
     
#   - task: NuGetCommand@2
#     displayName: Publish Nuget To Repository
#     name: publishnuget
#     inputs:
#      command: push
#      packagesToPush: "./src/build/*.nupkg"
#      publishVstsFeed: AutomationPlatform/AzArtifactsPSModules
     